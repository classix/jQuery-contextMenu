{"version":3,"sources":["jquery.contextMenu.min.js"],"names":["factory","define","amd","exports","require","jQuery","$","orig","support","htmlMenuitem","window","htmlCommand","eventSelectstart","document","documentElement","ui","widget","cleanData","elems","events","elem","i","_data","remove","triggerHandler","e","$currentTrigger","initialized","$win","counter","namespaces","menus","types","defaults","selector","appendTo","trigger","autoHide","delay","reposition","hideOnSecondTrigger","selectableSubMenu","classNames","hover","disabled","visible","notSelectable","icon","iconEdit","iconCut","iconCopy","iconPaste","iconDelete","iconAdd","iconQuit","iconLoadingClass","determinePosition","$menu","position","css","my","at","of","this","offset","collision","top","outerHeight","left","outerWidth","opt","x","y","offsetParentOffset","offsetParent","bottom","scrollTop","height","right","scrollLeft","width","call","positionSubmenu","zIndex","animation","duration","show","hide","preShow","noop","activated","callback","items","hoveract","timer","pageX","pageY","handle","abortevent","preventDefault","stopImmediatePropagation","contextmenu","$this","data","originalEvent","mouseButton","hasClass","promise","Deferred","resolve","build","built","extend","isEmptyObject","then","console","error","log","Error","$trigger","op","create","click","Event","button","mousedown","length","is","mouseup","removeData","mouseenter","$related","relatedTarget","$document","closest","on","mousemove","setTimeout","off","mouseleave","clearTimeout","layerClick","target","root","fakeClick","undefined","$window","triggerAction","elementFromPoint","$layer","isContentEditable","range","createRange","sel","getSelection","selectNode","collapse","removeAllRanges","addRange","one","contextMenu","keyStop","isInput","stopPropagation","key","targetZIndex","getZIndexOfTriggerTarget","style","parentElement","parseInt","keyCode","shiftKey","$selected","find","blur","prop","parent","$parent","itemdata","children","k","String","fromCharCode","toUpperCase","accesskeys","$node","prevItem","$s","$children","$prev","prev","last","$round","itemMouseleave","get","parentTop","childTop","scrollIntoView","itemMouseenter","$input","focus","nextItem","$next","next","first","focusInput","contextMenuRoot","blurInput","menuMouseenter","hovering","menuMouseleave","itemClick","contextMenuKey","isFunction","callbacks","Object","prototype","hasOwnProperty","update","inputClick","hideMenu","force","focusItem","addClass","join","not","removeClass","filter","blurItem","additionalZValue","$t","zin","$tt","Math","max","indexOf","toLowerCase","zindex","layer","pos","each","createNameNode","item","$name","_accesskey","_beforeAccesskey","append","createTextNode","text","_afterAccesskey","isHtmlName","accesskey","html","name","createContextMenuItems","className","$label","type","ak","aks","val","t","split","keys","charAt","push","splitAccesskey","matched","match","RegExp","commands","hasTypes","inputs","attr","value","selected","prependTo","radio","options","processPromises","_icon","substring","prepend","body","errorPromise","errorItem","finishPromiseProcess","bind","resize","nested","domMenu","display","getBoundingClientRect","ceil","minWidth","maxWidth","addBack","hasVisibleItems","$item","iconResult","z-index","opacity","background-color","insertBefore","index","menuElm","$menuOffset","winHeight","winScrollTop","menuHeight","overflow-x","overflow-y","inputLabel","node","id","fn","operation","$o","context","isPlainObject","o","$context","_hasContext","menu","ns","itemClickEvent","contextMenuItemObj","contextmenu:focus.contextMenu","contextmenu:blur.contextMenu","contextmenu.contextMenu","mouseenter.contextMenu","mouseleave.contextMenu","contextmenu:hide.contextMenu","prevcommand.contextMenu","nextcommand.contextMenu","$visibleMenu","fromMenu","setInputValues","getInputValues","element","menuChildren","label","nodeName","clone"],"mappings":"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","file":"jquery.contextMenu.min.js","sourcesContent":["/**\r\n * jQuery contextMenu v2.8.0 - Plugin for simple contextMenu handling\r\n *\r\n * Version: v2.8.0\r\n *\r\n * Authors: Bj√∂rn Brala (SWIS.nl), Rodney Rehm, Addy Osmani (patches for FF)\r\n * Web: http://swisnl.github.io/jQuery-contextMenu/\r\n *\r\n * Copyright (c) 2011-2019 SWIS BV and contributors\r\n *\r\n * Licensed under\r\n *   MIT License http://www.opensource.org/licenses/mit-license\r\n *\r\n * Date: 2019-07-19T13:03:14.108Z\r\n */\r\n\r\n// jscs:disable\r\n/* jshint ignore:start */\r\n(function (factory) {\r\n    if (typeof define === 'function' && define.amd) {\r\n        // AMD. Register as anonymous module.\r\n        define(['jquery'], factory);\r\n    } else if (typeof exports === 'object') {\r\n        // Node / CommonJS\r\n        factory(require('jquery'));\r\n    } else {\r\n        // Browser globals.\r\n        factory(jQuery);\r\n    }\r\n})(function ($) {\r\n\r\n    'use strict';\r\n\r\n    // TODO: -\r\n    // ARIA stuff: menuitem, menuitemcheckbox und menuitemradio\r\n    // create <menu> structure if $.support[htmlCommand || htmlMenuitem] and !opt.disableNative\r\n\r\n    // determine html5 compatibility\r\n    $.support.htmlMenuitem = ('HTMLMenuItemElement' in window);\r\n    $.support.htmlCommand = ('HTMLCommandElement' in window);\r\n    $.support.eventSelectstart = ('onselectstart' in document.documentElement);\r\n    /* // should the need arise, test for css user-select\r\n     $.support.cssUserSelect = (function(){\r\n     var t = false,\r\n     e = document.createElement('div');\r\n\r\n     $.each('Moz|Webkit|Khtml|O|ms|Icab|'.split('|'), function(i, prefix) {\r\n     var propCC = prefix + (prefix ? 'U' : 'u') + 'serSelect',\r\n     prop = (prefix ? ('-' + prefix.toLowerCase() + '-') : '') + 'user-select';\r\n\r\n     e.style.cssText = prop + ': text;';\r\n     if (e.style[propCC] == 'text') {\r\n     t = true;\r\n     return false;\r\n     }\r\n\r\n     return true;\r\n     });\r\n\r\n     return t;\r\n     })();\r\n     */\r\n\r\n\r\n    if (!$.ui || !$.widget) {\r\n        // duck punch $.cleanData like jQueryUI does to get that remove event\r\n        $.cleanData = (function (orig) {\r\n            return function (elems) {\r\n                var events, elem, i;\r\n                for (i = 0; elems[i] != null; i++) {\r\n                    elem = elems[i];\r\n                    try {\r\n                        // Only trigger remove when necessary to save time\r\n                        events = $._data(elem, 'events');\r\n                        if (events && events.remove) {\r\n                            $(elem).triggerHandler('remove');\r\n                        }\r\n\r\n                        // Http://bugs.jquery.com/ticket/8235\r\n                    } catch (e) {\r\n                    }\r\n                }\r\n                orig(elems);\r\n            };\r\n        })($.cleanData);\r\n    }\r\n    /* jshint ignore:end */\r\n    // jscs:enable\r\n\r\n    var // currently active contextMenu trigger\r\n        $currentTrigger = null,\r\n        // is contextMenu initialized with at least one menu?\r\n        initialized = false,\r\n        // window handle\r\n        $win = $(window),\r\n        // number of registered menus\r\n        counter = 0,\r\n        // mapping selector to namespace\r\n        namespaces = {},\r\n        // mapping namespace to options\r\n        menus = {},\r\n        // custom command type handlers\r\n        types = {},\r\n        // default values\r\n        defaults = {\r\n            // selector of contextMenu trigger\r\n            selector: null,\r\n            // where to append the menu to\r\n            appendTo: null,\r\n            // method to trigger context menu [\"right\", \"left\", \"hover\"]\r\n            trigger: 'right',\r\n            // hide menu when mouse leaves trigger / menu elements\r\n            autoHide: false,\r\n            // ms to wait before showing a hover-triggered context menu\r\n            delay: 200,\r\n            // flag denoting if a second trigger should simply move (true) or rebuild (false) an open menu\r\n            // as long as the trigger happened on one of the trigger-element's child nodes\r\n            reposition: true,\r\n            // Flag denoting if a second trigger should close the menu, as long as\r\n            // the trigger happened on one of the trigger-element's child nodes.\r\n            // This overrides the reposition option.\r\n            hideOnSecondTrigger: false,\r\n\r\n            //ability to select submenu\r\n            selectableSubMenu: false,\r\n\r\n            // Default classname configuration to be able avoid conflicts in frameworks\r\n            classNames: {\r\n                hover: 'context-menu-hover', // Item hover\r\n                disabled: 'context-menu-disabled', // Item disabled\r\n                visible: 'context-menu-visible', // Item visible\r\n                notSelectable: 'context-menu-not-selectable', // Item not selectable\r\n\r\n                icon: 'context-menu-icon',\r\n                iconEdit: 'context-menu-icon-edit',\r\n                iconCut: 'context-menu-icon-cut',\r\n                iconCopy: 'context-menu-icon-copy',\r\n                iconPaste: 'context-menu-icon-paste',\r\n                iconDelete: 'context-menu-icon-delete',\r\n                iconAdd: 'context-menu-icon-add',\r\n                iconQuit: 'context-menu-icon-quit',\r\n                iconLoadingClass: 'context-menu-icon-loading'\r\n            },\r\n\r\n            // determine position to show menu at\r\n            determinePosition: function ($menu) {\r\n                // position to the lower middle of the trigger element\r\n                if ($.ui && $.ui.position) {\r\n                    // .position() is provided as a jQuery UI utility\r\n                    // (...and it won't work on hidden elements)\r\n                    $menu.css('display', 'block').position({\r\n                        my: 'center top',\r\n                        at: 'center bottom',\r\n                        of: this,\r\n                        offset: '0 5',\r\n                        collision: 'fit'\r\n                    }).css('display', 'none');\r\n                } else {\r\n                    // determine contextMenu position\r\n                    var offset = this.offset();\r\n                    offset.top += this.outerHeight();\r\n                    offset.left += this.outerWidth() / 2 - $menu.outerWidth() / 2;\r\n                    $menu.css(offset);\r\n                }\r\n            },\r\n            // position menu\r\n            position: function (opt, x, y) {\r\n                var offset;\r\n                // determine contextMenu position\r\n                if (!x && !y) {\r\n                    opt.determinePosition.call(this, opt.$menu);\r\n                    return;\r\n                } else if (x === 'maintain' && y === 'maintain') {\r\n                    // x and y must not be changed (after re-show on command click)\r\n                    offset = opt.$menu.position();\r\n                } else {\r\n                    // x and y are given (by mouse event)\r\n                    var offsetParentOffset = opt.$menu.offsetParent().offset();\r\n                    offset = {top: y - offsetParentOffset.top, left: x -offsetParentOffset.left};\r\n                }\r\n\r\n                // correct offset if viewport demands it\r\n                var bottom = $win.scrollTop() + $win.height(),\r\n                    right = $win.scrollLeft() + $win.width(),\r\n                    height = opt.$menu.outerHeight(),\r\n                    width = opt.$menu.outerWidth();\r\n\r\n                if (offset.top + height > bottom) {\r\n                    offset.top -= height;\r\n                }\r\n\r\n                if (offset.top < 0) {\r\n                    offset.top = 0;\r\n                }\r\n\r\n                if (offset.left + width > right) {\r\n                    offset.left -= width;\r\n                }\r\n\r\n                if (offset.left < 0) {\r\n                    offset.left = 0;\r\n                }\r\n\r\n                opt.$menu.css(offset);\r\n            },\r\n            // position the sub-menu\r\n            positionSubmenu: function ($menu) {\r\n                if (typeof $menu === 'undefined') {\r\n                    // When user hovers over item (which has sub items) handle.focusItem will call this.\r\n                    // but the submenu does not exist yet if opt.items is a promise. just return, will\r\n                    // call positionSubmenu after promise is completed.\r\n                    return;\r\n                }\r\n                if ($.ui && $.ui.position) {\r\n                    // .position() is provided as a jQuery UI utility\r\n                    // (...and it won't work on hidden elements)\r\n                    $menu.css('display', 'block').position({\r\n                        my: 'left top-5',\r\n                        at: 'right top',\r\n                        of: this,\r\n                        collision: 'flipfit fit'\r\n                    }).css('display', '');\r\n                } else {\r\n                    // determine contextMenu position\r\n                    var offset = {\r\n                        top: -9,\r\n                        left: this.outerWidth() - 5\r\n                    };\r\n                    $menu.css(offset);\r\n                }\r\n            },\r\n            // offset to add to zIndex\r\n            zIndex: 1,\r\n            // show hide animation settings\r\n            animation: {\r\n                duration: 50,\r\n                show: 'slideDown',\r\n                hide: 'slideUp'\r\n            },\r\n            // events\r\n            events: {\r\n                preShow: $.noop,\r\n                show: $.noop,\r\n                hide: $.noop,\r\n                activated: $.noop\r\n            },\r\n            // default callback\r\n            callback: null,\r\n            // list of contextMenu items\r\n            items: {}\r\n        },\r\n        // mouse position for hover activation\r\n        hoveract = {\r\n            timer: null,\r\n            pageX: null,\r\n            pageY: null\r\n        },\r\n        // determine zIndex\r\n        zindex = function ($t) {\r\n            var zin = 0,\r\n                $tt = $t;\r\n\r\n            while (true) {\r\n                zin = Math.max(zin, parseInt($tt.css('z-index'), 10) || 0);\r\n                $tt = $tt.parent();\r\n                if (!$tt || !$tt.length || 'html body'.indexOf($tt.prop('nodeName').toLowerCase()) > -1) {\r\n                    break;\r\n                }\r\n            }\r\n            return zin;\r\n        },\r\n        // event handlers\r\n        handle = {\r\n            // abort anything\r\n            abortevent: function (e) {\r\n                e.preventDefault();\r\n                e.stopImmediatePropagation();\r\n            },\r\n            // contextmenu show dispatcher\r\n            contextmenu: function (e) {\r\n                var $this = $(this);\r\n\r\n                //Show browser context-menu when preShow returns false\r\n                if (e.data.events.preShow($this,e) === false) {\r\n                    return;\r\n                }\r\n\r\n                // disable actual context-menu if we are using the right mouse button as the trigger\r\n                if (e.data.trigger === 'right') {\r\n                    e.preventDefault();\r\n                    e.stopImmediatePropagation();\r\n                }\r\n\r\n                // abort native-triggered events unless we're triggering on right click\r\n                if ((e.data.trigger !== 'right' && e.data.trigger !== 'demand') && e.originalEvent) {\r\n                    return;\r\n                }\r\n\r\n                // Let the current contextmenu decide if it should show or not based on its own trigger settings\r\n                if (typeof e.mouseButton !== 'undefined' && e.data) {\r\n                    if (!(e.data.trigger === 'left' && e.mouseButton === 0) && !(e.data.trigger === 'right' && e.mouseButton === 2)) {\r\n                        // Mouse click is not valid.\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                // abort event if menu is visible for this trigger\r\n                if ($this.hasClass('context-menu-active')) {\r\n                    return;\r\n                }\r\n\r\n                if (!$this.hasClass('context-menu-disabled')) {\r\n                    // theoretically need to fire a show event at <menu>\r\n                    // http://www.whatwg.org/specs/web-apps/current-work/multipage/interactive-elements.html#context-menus\r\n                    // var evt = jQuery.Event(\"show\", { data: data, pageX: e.pageX, pageY: e.pageY, relatedTarget: this });\r\n                    // e.data.$menu.trigger(evt);\r\n\r\n                    $currentTrigger = $this;\r\n                    var promise = $.Deferred().resolve().promise();\r\n                    if (e.data.build) {\r\n                        var built = e.data.build($currentTrigger, e);\r\n                        // abort if build() returned false\r\n                        if (built === false) {\r\n                            return;\r\n                        }\r\n\r\n                        // dynamically build menu on invocation\r\n                        e.data = $.extend(true, {}, defaults, e.data, built || {});\r\n\r\n                        // abort if there are no items to display\r\n                        // make sure items is not a promise\r\n                        if (!e.data.items || ($.isEmptyObject(e.data.items) && 'function' !== typeof e.data.items.then)) {\r\n                            // Note: jQuery captures and ignores errors from event handlers\r\n                            if (window.console) {\r\n                                (console.error || console.log).call(console, 'No items specified to show in contextMenu');\r\n                            }\r\n\r\n                            throw new Error('No Items specified');\r\n                        }\r\n\r\n                        // backreference for custom command type creation\r\n                        e.data.$trigger = $currentTrigger;\r\n\r\n                        promise = op.create(e.data);\r\n                    }\r\n                    promise.then(function () {\r\n                        op.show.call($this, e.data, e.pageX, e.pageY);\r\n                    });\r\n                }\r\n            },\r\n            // contextMenu left-click trigger\r\n            click: function (e) {\r\n                e.preventDefault();\r\n                e.stopImmediatePropagation();\r\n                $(this).trigger($.Event('contextmenu', {data: e.data, pageX: e.pageX, pageY: e.pageY, mouseButton: e.button}));\r\n            },\r\n            // contextMenu right-click trigger\r\n            mousedown: function (e) {\r\n                // register mouse down\r\n                var $this = $(this);\r\n\r\n                // hide any previous menus\r\n                if ($currentTrigger && $currentTrigger.length && !$currentTrigger.is($this)) {\r\n                    $currentTrigger.data('contextMenu').$menu.trigger('contextmenu:hide');\r\n                }\r\n\r\n                // activate on right click\r\n                if (e.button === 2) {\r\n                    $currentTrigger = $this.data('contextMenuActive', true);\r\n                }\r\n            },\r\n            // contextMenu right-click trigger\r\n            mouseup: function (e) {\r\n                // show menu\r\n                var $this = $(this);\r\n                if ($this.data('contextMenuActive') && $currentTrigger && $currentTrigger.length && $currentTrigger.is($this) && !$this.hasClass('context-menu-disabled')) {\r\n                    e.preventDefault();\r\n                    e.stopImmediatePropagation();\r\n                    $currentTrigger = $this;\r\n                    $this.trigger($.Event('contextmenu', {data: e.data, pageX: e.pageX, pageY: e.pageY}));\r\n                }\r\n\r\n                $this.removeData('contextMenuActive');\r\n            },\r\n            // contextMenu hover trigger\r\n            mouseenter: function (e) {\r\n                var $this = $(this),\r\n                    $related = $(e.relatedTarget),\r\n                    $document = $(document);\r\n\r\n                // abort if we're coming from a menu\r\n                if ($related.is('.context-menu-list') || $related.closest('.context-menu-list').length) {\r\n                    return;\r\n                }\r\n\r\n                // abort if a menu is shown\r\n                if ($currentTrigger && $currentTrigger.length) {\r\n                    return;\r\n                }\r\n\r\n                hoveract.pageX = e.pageX;\r\n                hoveract.pageY = e.pageY;\r\n                hoveract.data = e.data;\r\n                $document.on('mousemove.contextMenuShow', handle.mousemove);\r\n                hoveract.timer = setTimeout(function () {\r\n                    hoveract.timer = null;\r\n                    $document.off('mousemove.contextMenuShow');\r\n                    $currentTrigger = $this;\r\n                    $this.trigger($.Event('contextmenu', {\r\n                        data: hoveract.data,\r\n                        pageX: hoveract.pageX,\r\n                        pageY: hoveract.pageY\r\n                    }));\r\n                }, e.data.delay);\r\n            },\r\n            // contextMenu hover trigger\r\n            mousemove: function (e) {\r\n                hoveract.pageX = e.pageX;\r\n                hoveract.pageY = e.pageY;\r\n            },\r\n            // contextMenu hover trigger\r\n            mouseleave: function (e) {\r\n                // abort if we're leaving for a menu\r\n                var $related = $(e.relatedTarget);\r\n                if ($related.is('.context-menu-list') || $related.closest('.context-menu-list').length) {\r\n                    return;\r\n                }\r\n\r\n                try {\r\n                    clearTimeout(hoveract.timer);\r\n                } catch (e) {\r\n                }\r\n\r\n                hoveract.timer = null;\r\n            },\r\n            // click on layer to hide contextMenu\r\n            layerClick: function (e) {\r\n                var $this = $(this),\r\n                    root = $this.data('contextMenuRoot'),\r\n                    button = e.button,\r\n                    x = e.pageX,\r\n                    y = e.pageY,\r\n                    fakeClick = x === undefined,\r\n                    target,\r\n                    offset;\r\n\r\n                e.preventDefault();\r\n\r\n                setTimeout(function () {\r\n                    // If the click is not real, things break: https://github.com/swisnl/jQuery-contextMenu/issues/132\r\n                    if(fakeClick){\r\n                        if (root !== null && typeof root !== 'undefined' && root.$menu !== null  && typeof root.$menu !== 'undefined') {\r\n                            root.$menu.trigger('contextmenu:hide');\r\n                        }\r\n                        return;\r\n                    }\r\n\r\n                    var $window;\r\n                    var triggerAction = ((root.trigger === 'left' && button === 0) || (root.trigger === 'right' && button === 2));\r\n\r\n                    // find the element that would've been clicked, wasn't the layer in the way\r\n                    if (document.elementFromPoint && root.$layer) {\r\n                        root.$layer.hide();\r\n                        target = document.elementFromPoint(x - $win.scrollLeft(), y - $win.scrollTop());\r\n\r\n                        // also need to try and focus this element if we're in a contenteditable area,\r\n                        // as the layer will prevent the browser mouse action we want\r\n                        if (target.isContentEditable) {\r\n                            var range = document.createRange(),\r\n                                sel = window.getSelection();\r\n                            range.selectNode(target);\r\n                            range.collapse(true);\r\n                            sel.removeAllRanges();\r\n                            sel.addRange(range);\r\n                        }\r\n                        $(target).trigger(e);\r\n                        root.$layer.show();\r\n                    }\r\n\r\n                    if (root.hideOnSecondTrigger && triggerAction && root.$menu !== null && typeof root.$menu !== 'undefined') {\r\n                      root.$menu.trigger('contextmenu:hide');\r\n                      return;\r\n                    }\r\n\r\n                    if (root.reposition && triggerAction) {\r\n                        if (document.elementFromPoint) {\r\n                            if (root.$trigger.is(target)) {\r\n                                root.position.call(root.$trigger, root, x, y);\r\n                                return;\r\n                            }\r\n                        } else {\r\n                            offset = root.$trigger.offset();\r\n                            $window = $(window);\r\n                            // while this looks kinda awful, it's the best way to avoid\r\n                            // unnecessarily calculating any positions\r\n                            offset.top += $window.scrollTop();\r\n                            if (offset.top <= e.pageY) {\r\n                                offset.left += $window.scrollLeft();\r\n                                if (offset.left <= e.pageX) {\r\n                                    offset.bottom = offset.top + root.$trigger.outerHeight();\r\n                                    if (offset.bottom >= e.pageY) {\r\n                                        offset.right = offset.left + root.$trigger.outerWidth();\r\n                                        if (offset.right >= e.pageX) {\r\n                                            // reposition\r\n                                            root.position.call(root.$trigger, root, x, y);\r\n                                            return;\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (target && triggerAction) {\r\n                        root.$trigger.one('contextmenu:hidden', function () {\r\n                            $(target).contextMenu({x: x, y: y, button: button});\r\n                        });\r\n                    }\r\n\r\n                    if (root !== null && typeof root !== 'undefined' && root.$menu !== null  && typeof root.$menu !== 'undefined') {\r\n                        root.$menu.trigger('contextmenu:hide');\r\n                    }\r\n                }, 50);\r\n            },\r\n            // key handled :hover\r\n            keyStop: function (e, opt) {\r\n                if (!opt.isInput) {\r\n                    e.preventDefault();\r\n                }\r\n\r\n                e.stopPropagation();\r\n            },\r\n            key: function (e) {\r\n\r\n                var opt = {};\r\n\r\n                // Only get the data from $currentTrigger if it exists\r\n                if ($currentTrigger) {\r\n                    opt = $currentTrigger.data('contextMenu') || {};\r\n                }\r\n                // If the trigger happen on a element that are above the contextmenu do this\r\n                if (typeof opt.zIndex === 'undefined') {\r\n                    opt.zIndex = 0;\r\n                }\r\n                var targetZIndex = 0;\r\n                var getZIndexOfTriggerTarget = function (target) {\r\n                    if (target.style.zIndex !== '') {\r\n                        targetZIndex = target.style.zIndex;\r\n                    } else {\r\n                        if (target.offsetParent !== null && typeof target.offsetParent !== 'undefined') {\r\n                            getZIndexOfTriggerTarget(target.offsetParent);\r\n                        }\r\n                        else if (target.parentElement !== null && typeof target.parentElement !== 'undefined') {\r\n                            getZIndexOfTriggerTarget(target.parentElement);\r\n                        }\r\n                    }\r\n                };\r\n                getZIndexOfTriggerTarget(e.target);\r\n                // If targetZIndex is heigher then opt.zIndex dont progress any futher.\r\n                // This is used to make sure that if you are using a dialog with a input / textarea / contenteditable div\r\n                // and its above the contextmenu it wont steal keys events\r\n                if (opt.$menu && parseInt(targetZIndex,10) > parseInt(opt.$menu.css(\"zIndex\"),10)) {\r\n                    return;\r\n                }\r\n                switch (e.keyCode) {\r\n                    case 9:\r\n                    case 38: // up\r\n                        handle.keyStop(e, opt);\r\n                        // if keyCode is [38 (up)] or [9 (tab) with shift]\r\n                        if (opt.isInput) {\r\n                            if (e.keyCode === 9 && e.shiftKey) {\r\n                                e.preventDefault();\r\n                                if (opt.$selected) {\r\n                                    opt.$selected.find('input, textarea, select').blur();\r\n                                }\r\n                                if (opt.$menu !== null && typeof opt.$menu !== 'undefined') {\r\n                                    opt.$menu.trigger('prevcommand');\r\n                                }\r\n                                return;\r\n                            } else if (e.keyCode === 38 && opt.$selected.find('input, textarea, select').prop('type') === 'checkbox') {\r\n                                // checkboxes don't capture this key\r\n                                e.preventDefault();\r\n                                return;\r\n                            }\r\n                        } else if (e.keyCode !== 9 || e.shiftKey) {\r\n                            if (opt.$menu !== null && typeof opt.$menu !== 'undefined') {\r\n                                opt.$menu.trigger('prevcommand');\r\n                            }\r\n                            return;\r\n                        }\r\n                        break;\r\n                    // omitting break;\r\n                    // case 9: // tab - reached through omitted break;\r\n                    case 40: // down\r\n                        handle.keyStop(e, opt);\r\n                        if (opt.isInput) {\r\n                            if (e.keyCode === 9) {\r\n                                e.preventDefault();\r\n                                if (opt.$selected) {\r\n                                    opt.$selected.find('input, textarea, select').blur();\r\n                                }\r\n                                if (opt.$menu !== null && typeof opt.$menu !== 'undefined') {\r\n                                    opt.$menu.trigger('nextcommand');\r\n                                }\r\n                                return;\r\n                            } else if (e.keyCode === 40 && opt.$selected.find('input, textarea, select').prop('type') === 'checkbox') {\r\n                                // checkboxes don't capture this key\r\n                                e.preventDefault();\r\n                                return;\r\n                            }\r\n                        } else {\r\n                            if (opt.$menu !== null && typeof opt.$menu !== 'undefined') {\r\n                                opt.$menu.trigger('nextcommand');\r\n                            }\r\n                            return;\r\n                        }\r\n                        break;\r\n\r\n                    case 37: // left\r\n                        handle.keyStop(e, opt);\r\n                        if (opt.isInput || !opt.$selected || !opt.$selected.length) {\r\n                            break;\r\n                        }\r\n\r\n                        if (!opt.$selected.parent().hasClass('context-menu-root')) {\r\n                            var $parent = opt.$selected.parent().parent();\r\n                            opt.$selected.trigger('contextmenu:blur');\r\n                            opt.$selected = $parent;\r\n                            return;\r\n                        }\r\n                        break;\r\n\r\n                    case 39: // right\r\n                        handle.keyStop(e, opt);\r\n                        if (opt.isInput || !opt.$selected || !opt.$selected.length) {\r\n                            break;\r\n                        }\r\n\r\n                        var itemdata = opt.$selected.data('contextMenu') || {};\r\n                        if (itemdata.$menu && opt.$selected.hasClass('context-menu-submenu')) {\r\n                            opt.$selected = null;\r\n                            itemdata.$selected = null;\r\n                            itemdata.$menu.trigger('nextcommand');\r\n                            return;\r\n                        }\r\n                        break;\r\n\r\n                    case 35: // end\r\n                    case 36: // home\r\n                        if (opt.$selected && opt.$selected.find('input, textarea, select').length) {\r\n                            return;\r\n                        } else {\r\n                            (opt.$selected && opt.$selected.parent() || opt.$menu)\r\n                                .children(':not(.' + opt.classNames.disabled + ', .' + opt.classNames.notSelectable + ')')[e.keyCode === 36 ? 'first' : 'last']()\r\n                                .trigger('contextmenu:focus');\r\n                            e.preventDefault();\r\n                            return;\r\n                        }\r\n                        break;\r\n\r\n                    case 13: // enter\r\n                        handle.keyStop(e, opt);\r\n                        if (opt.isInput) {\r\n                            if (opt.$selected && !opt.$selected.is('textarea, select')) {\r\n                                e.preventDefault();\r\n                                return;\r\n                            }\r\n                            break;\r\n                        }\r\n                        if (typeof opt.$selected !== 'undefined' && opt.$selected !== null) {\r\n                            opt.$selected.trigger('mouseup');\r\n                        }\r\n                        return;\r\n\r\n                    case 32: // space\r\n                    case 33: // page up\r\n                    case 34: // page down\r\n                        // prevent browser from scrolling down while menu is visible\r\n                        handle.keyStop(e, opt);\r\n                        return;\r\n\r\n                    case 27: // esc\r\n                        handle.keyStop(e, opt);\r\n                        if (opt.$menu !== null && typeof opt.$menu !== 'undefined') {\r\n                            opt.$menu.trigger('contextmenu:hide');\r\n                        }\r\n                        return;\r\n\r\n                    default: // 0-9, a-z\r\n                        var k = (String.fromCharCode(e.keyCode)).toUpperCase();\r\n                        if (opt.accesskeys && opt.accesskeys[k]) {\r\n                            // according to the specs accesskeys must be invoked immediately\r\n                            opt.accesskeys[k].$node.trigger(opt.accesskeys[k].$menu ? 'contextmenu:focus' : 'mouseup');\r\n                            return;\r\n                        }\r\n                        break;\r\n                }\r\n                // pass event to selected item,\r\n                // stop propagation to avoid endless recursion\r\n                e.stopPropagation();\r\n                if (typeof opt.$selected !== 'undefined' && opt.$selected !== null) {\r\n                    opt.$selected.trigger(e);\r\n                }\r\n            },\r\n            // select previous possible command in menu\r\n            prevItem: function (e) {\r\n                e.stopPropagation();\r\n                var opt = $(this).data('contextMenu') || {};\r\n                var root = $(this).data('contextMenuRoot') || {};\r\n\r\n                // obtain currently selected menu\r\n                if (opt.$selected) {\r\n                    var $s = opt.$selected;\r\n                    opt = opt.$selected.parent().data('contextMenu') || {};\r\n                    opt.$selected = $s;\r\n                }\r\n\r\n                var $children = opt.$menu.children(),\r\n                    $prev = !opt.$selected || !opt.$selected.prev().length ? $children.last() : opt.$selected.prev(),\r\n                    $round = $prev;\r\n\r\n                // skip disabled or hidden elements\r\n                while ($prev.hasClass(root.classNames.disabled) || $prev.hasClass(root.classNames.notSelectable) || $prev.is(':hidden')) {\r\n                    if ($prev.prev().length) {\r\n                        $prev = $prev.prev();\r\n                    } else {\r\n                        $prev = $children.last();\r\n                    }\r\n                    if ($prev.is($round)) {\r\n                        // break endless loop\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                // leave current\r\n                if (opt.$selected) {\r\n                    handle.itemMouseleave.call(opt.$selected.get(0), e);\r\n                }\r\n\r\n                // scroll to item if needed (using keyboard navigation)\r\n                // hint: you can reach the next item not only with down arrow, but also with the up arrow at the last item\r\n                // and the same holds for previous item - so we need to take regard to both conditions.\r\n                var offsetParent = $prev.offsetParent();\r\n                var parentTop = offsetParent.offset().top;\r\n                var childTop = $prev.offset().top;\r\n                if (offsetParent && ((childTop >= parentTop + offsetParent.height()) || (childTop < parentTop))) {\r\n                    $prev[0].scrollIntoView(true);\r\n                }\r\n\r\n                // activate next\r\n                handle.itemMouseenter.call($prev.get(0), e);\r\n\r\n                // focus input\r\n                var $input = $prev.find('input, textarea, select');\r\n                if ($input.length) {\r\n                    $input.focus();\r\n                }\r\n            },\r\n            // select next possible command in menu\r\n            nextItem: function (e) {\r\n                e.stopPropagation();\r\n                var opt = $(this).data('contextMenu') || {};\r\n                var root = $(this).data('contextMenuRoot') || {};\r\n\r\n                // obtain currently selected menu\r\n                if (opt.$selected) {\r\n                    var $s = opt.$selected;\r\n                    opt = opt.$selected.parent().data('contextMenu') || {};\r\n                    opt.$selected = $s;\r\n                }\r\n\r\n                var $children = opt.$menu.children(),\r\n                    $next = !opt.$selected || !opt.$selected.next().length ? $children.first() : opt.$selected.next(),\r\n                    $round = $next;\r\n\r\n                // skip disabled\r\n                while ($next.hasClass(root.classNames.disabled) || $next.hasClass(root.classNames.notSelectable) || $next.is(':hidden')) {\r\n                    if ($next.next().length) {\r\n                        $next = $next.next();\r\n                    } else {\r\n                        $next = $children.first();\r\n                    }\r\n                    if ($next.is($round)) {\r\n                        // break endless loop\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                // leave current\r\n                if (opt.$selected) {\r\n                    handle.itemMouseleave.call(opt.$selected.get(0), e);\r\n                }\r\n\r\n                // scroll to item if needed (using keyboard navigation)\r\n                // hint: you can reach the next item not only with down arrow, but also with the up arrow at the last item\r\n                // and the same holds for previous item - so we need to take regard to both conditions.\r\n                var offsetParent = $next.offsetParent();\r\n                var parentTop = offsetParent.offset().top;\r\n                var childTop = $next.offset().top;\r\n                if (offsetParent && ((childTop >= parentTop + offsetParent.height()) || (childTop < parentTop))) {\r\n                    $next[0].scrollIntoView(false);\r\n                }\r\n\r\n                // activate next\r\n                handle.itemMouseenter.call($next.get(0), e);\r\n\r\n                // focus input\r\n                var $input = $next.find('input, textarea, select');\r\n                if ($input.length) {\r\n                    $input.focus();\r\n                }\r\n            },\r\n            // flag that we're inside an input so the key handler can act accordingly\r\n            focusInput: function () {\r\n                var $this = $(this).closest('.context-menu-item'),\r\n                    data = $this.data(),\r\n                    opt = data.contextMenu,\r\n                    root = data.contextMenuRoot;\r\n\r\n                root.$selected = opt.$selected = $this;\r\n                root.isInput = opt.isInput = true;\r\n            },\r\n            // flag that we're inside an input so the key handler can act accordingly\r\n            blurInput: function () {\r\n                var $this = $(this).closest('.context-menu-item'),\r\n                    data = $this.data(),\r\n                    opt = data.contextMenu,\r\n                    root = data.contextMenuRoot;\r\n\r\n                root.isInput = opt.isInput = false;\r\n            },\r\n            // :hover on menu\r\n            menuMouseenter: function () {\r\n                var root = $(this).data().contextMenuRoot;\r\n                root.hovering = true;\r\n            },\r\n            // :hover on menu\r\n            menuMouseleave: function (e) {\r\n                var root = $(this).data().contextMenuRoot;\r\n                if (root.$layer && root.$layer.is(e.relatedTarget)) {\r\n                    root.hovering = false;\r\n                }\r\n            },\r\n            // :hover done manually so key handling is possible\r\n            itemMouseenter: function (e) {\r\n                var $this = $(this),\r\n                    data = $this.data(),\r\n                    opt = data.contextMenu,\r\n                    root = data.contextMenuRoot;\r\n\r\n                root.hovering = true;\r\n\r\n                // abort if we're re-entering\r\n                if (e && root.$layer && root.$layer.is(e.relatedTarget)) {\r\n                    e.preventDefault();\r\n                    e.stopImmediatePropagation();\r\n                }\r\n\r\n                // make sure only one item is selected\r\n                (opt.$menu ? opt : root).$menu\r\n                    .children('.' + root.classNames.hover).trigger('contextmenu:blur')\r\n                    .children('.hover').trigger('contextmenu:blur');\r\n\r\n                if ($this.hasClass(root.classNames.disabled) || $this.hasClass(root.classNames.notSelectable)) {\r\n                    opt.$selected = null;\r\n                    return;\r\n                }\r\n\r\n\r\n                $this.trigger('contextmenu:focus');\r\n            },\r\n            // :hover done manually so key handling is possible\r\n            itemMouseleave: function (e) {\r\n                var $this = $(this),\r\n                    data = $this.data(),\r\n                    opt = data.contextMenu,\r\n                    root = data.contextMenuRoot;\r\n\r\n                if (root !== opt && root.$layer && root.$layer.is(e.relatedTarget)) {\r\n                    if (typeof root.$selected !== 'undefined' && root.$selected !== null) {\r\n                        root.$selected.trigger('contextmenu:blur');\r\n                    }\r\n                    e.preventDefault();\r\n                    e.stopImmediatePropagation();\r\n                    root.$selected = opt.$selected = opt.$node;\r\n                    return;\r\n                }\r\n\r\n                if(opt && opt.$menu && opt.$menu.hasClass('context-menu-visible')){\r\n                    return;\r\n                }\r\n\r\n                $this.trigger('contextmenu:blur');\r\n            },\r\n            // contextMenu item click\r\n            itemClick: function (e) {\r\n                var $this = $(this),\r\n                    data = $this.data(),\r\n                    opt = data.contextMenu,\r\n                    root = data.contextMenuRoot,\r\n                    key = data.contextMenuKey,\r\n                    callback;\r\n\r\n                // abort if the key is unknown or disabled or is a menu\r\n                if (!opt.items[key] || $this.is('.' + root.classNames.disabled + ', .context-menu-separator, .' + root.classNames.notSelectable) || ($this.is('.context-menu-submenu') && root.selectableSubMenu === false )) {\r\n                    return;\r\n                }\r\n\r\n                e.preventDefault();\r\n                e.stopImmediatePropagation();\r\n\r\n                if ($.isFunction(opt.callbacks[key]) && Object.prototype.hasOwnProperty.call(opt.callbacks, key)) {\r\n                    // item-specific callback\r\n                    callback = opt.callbacks[key];\r\n                } else if ($.isFunction(root.callback)) {\r\n                    // default callback\r\n                    callback = root.callback;\r\n                } else {\r\n                    // no callback, no action\r\n                    return;\r\n                }\r\n\r\n                // hide menu if callback doesn't stop that\r\n                if (callback.call(root.$trigger, key, root, e) !== false) {\r\n                    root.$menu.trigger('contextmenu:hide');\r\n                } else if (root.$menu.parent().length) {\r\n                    op.update.call(root.$trigger, root);\r\n                }\r\n            },\r\n            // ignore click events on input elements\r\n            inputClick: function (e) {\r\n                e.stopImmediatePropagation();\r\n            },\r\n            // hide <menu>\r\n            hideMenu: function (e, data) {\r\n                var root = $(this).data('contextMenuRoot');\r\n                op.hide.call(root.$trigger, root, data && data.force);\r\n            },\r\n            // focus <command>\r\n            focusItem: function (e) {\r\n                e.stopPropagation();\r\n                var $this = $(this),\r\n                    data = $this.data(),\r\n                    opt = data.contextMenu,\r\n                    root = data.contextMenuRoot;\r\n\r\n                if ($this.hasClass(root.classNames.disabled) || $this.hasClass(root.classNames.notSelectable)) {\r\n                    return;\r\n                }\r\n\r\n                $this\r\n                    .addClass([root.classNames.hover, root.classNames.visible].join(' '))\r\n                    // select other items and included items\r\n                    .parent().find('.context-menu-item').not($this)\r\n                    .removeClass(root.classNames.visible)\r\n                    .filter('.' + root.classNames.hover)\r\n                    .trigger('contextmenu:blur');\r\n\r\n                // remember selected\r\n                opt.$selected = root.$selected = $this;\r\n\r\n\r\n                if(opt && opt.$node && opt.$node.hasClass('context-menu-submenu')){\r\n                    opt.$node.addClass(root.classNames.hover);\r\n                }\r\n\r\n                // position sub-menu - do after show so dumb $.ui.position can keep up\r\n                if (opt.$node) {\r\n                    root.positionSubmenu.call(opt.$node, opt.$menu);\r\n                }\r\n            },\r\n            // blur <command>\r\n            blurItem: function (e) {\r\n                e.stopPropagation();\r\n                var $this = $(this),\r\n                    data = $this.data(),\r\n                    opt = data.contextMenu,\r\n                    root = data.contextMenuRoot;\r\n\r\n                if (opt.autoHide) { // for tablets and touch screens this needs to remain\r\n                    $this.removeClass(root.classNames.visible);\r\n                }\r\n                $this.removeClass(root.classNames.hover);\r\n                opt.$selected = null;\r\n            }\r\n        },\r\n        // operations\r\n        op = {\r\n            show: function (opt, x, y) {\r\n                var $trigger = $(this),\r\n                    css = {};\r\n\r\n                // hide any open menus\r\n                $('#context-menu-layer').trigger('mousedown');\r\n\r\n                // backreference for callbacks\r\n                opt.$trigger = $trigger;\r\n\r\n                // show event\r\n                if (opt.events.show.call($trigger, opt) === false) {\r\n                    $currentTrigger = null;\r\n                    return;\r\n                }\r\n\r\n                // create or update context menu\r\n                var hasVisibleItems = op.update.call($trigger, opt);\r\n                if (hasVisibleItems === false) {\r\n                    $currentTrigger = null;\r\n                    return;\r\n                }\r\n\r\n                // position menu\r\n                opt.position.call($trigger, opt, x, y);\r\n\r\n                // make sure we're in front\r\n                if (opt.zIndex) {\r\n                    var additionalZValue = opt.zIndex;\r\n                    // If opt.zIndex is a function, call the function to get the right zIndex.\r\n                    if (typeof opt.zIndex === 'function') {\r\n                        additionalZValue = opt.zIndex.call($trigger, opt);\r\n                    }\r\n                    css.zIndex = zindex($trigger) + additionalZValue;\r\n                }\r\n\r\n                // add layer\r\n                op.layer.call(opt.$menu, opt, css.zIndex);\r\n\r\n                // adjust sub-menu zIndexes\r\n                opt.$menu.find('ul').css('zIndex', css.zIndex + 1);\r\n\r\n                // position and show context menu\r\n                opt.$menu.css(css)[opt.animation.show](opt.animation.duration, function () {\r\n                    $trigger.trigger('contextmenu:visible');\r\n\r\n                    op.activated(opt);\r\n                    opt.events.activated(opt);\r\n                });\r\n                // make options available and set state\r\n                $trigger\r\n                    .data('contextMenu', opt)\r\n                    .addClass('context-menu-active');\r\n\r\n                // register key handler\r\n                $(document).off('keydown.contextMenu').on('keydown.contextMenu', handle.key);\r\n                // register autoHide handler\r\n                if (opt.autoHide) {\r\n                    // mouse position handler\r\n                    $(document).on('mousemove.contextMenuAutoHide', function (e) {\r\n                        // need to capture the offset on mousemove,\r\n                        // since the page might've been scrolled since activation\r\n                        var pos = $trigger.offset();\r\n                        pos.right = pos.left + $trigger.outerWidth();\r\n                        pos.bottom = pos.top + $trigger.outerHeight();\r\n\r\n                        if (opt.$layer && !opt.hovering && (!(e.pageX >= pos.left && e.pageX <= pos.right) || !(e.pageY >= pos.top && e.pageY <= pos.bottom))) {\r\n                            /* Additional hover check after short time, you might just miss the edge of the menu */\r\n                            setTimeout(function () {\r\n                                if (!opt.hovering && opt.$menu !== null && typeof opt.$menu !== 'undefined') {\r\n                                    opt.$menu.trigger('contextmenu:hide');\r\n                                }\r\n                            }, 50);\r\n                        }\r\n                    });\r\n                }\r\n            },\r\n            hide: function (opt, force) {\r\n                var $trigger = $(this);\r\n                if (!opt) {\r\n                    opt = $trigger.data('contextMenu') || {};\r\n                }\r\n\r\n                // hide event\r\n                if (!force && opt.events && opt.events.hide.call($trigger, opt) === false) {\r\n                    return;\r\n                }\r\n\r\n                // remove options and revert state\r\n                $trigger\r\n                    .removeData('contextMenu')\r\n                    .removeClass('context-menu-active');\r\n\r\n                if (opt.$layer) {\r\n                    // keep layer for a bit so the contextmenu event can be aborted properly by opera\r\n                    setTimeout((function ($layer) {\r\n                        return function () {\r\n                            $layer.remove();\r\n                        };\r\n                    })(opt.$layer), 10);\r\n\r\n                    try {\r\n                        delete opt.$layer;\r\n                    } catch (e) {\r\n                        opt.$layer = null;\r\n                    }\r\n                }\r\n\r\n                // remove handle\r\n                $currentTrigger = null;\r\n                // remove selected\r\n                opt.$menu.find('.' + opt.classNames.hover).trigger('contextmenu:blur');\r\n                opt.$selected = null;\r\n                // collapse all submenus\r\n                opt.$menu.find('.' + opt.classNames.visible).removeClass(opt.classNames.visible);\r\n                // unregister key and mouse handlers\r\n                // $(document).off('.contextMenuAutoHide keydown.contextMenu'); // http://bugs.jquery.com/ticket/10705\r\n                $(document).off('.contextMenuAutoHide').off('keydown.contextMenu');\r\n                // hide menu\r\n                if (opt.$menu) {\r\n                    opt.$menu[opt.animation.hide](opt.animation.duration, function () {\r\n                        // tear down dynamically built menu after animation is completed.\r\n                        if (opt.build) {\r\n                            opt.$menu.remove();\r\n                            $.each(opt, function (key) {\r\n                                switch (key) {\r\n                                    case 'ns':\r\n                                    case 'selector':\r\n                                    case 'build':\r\n                                    case 'trigger':\r\n                                        return true;\r\n\r\n                                    default:\r\n                                        opt[key] = undefined;\r\n                                        try {\r\n                                            delete opt[key];\r\n                                        } catch (e) {\r\n                                        }\r\n                                        return true;\r\n                                }\r\n                            });\r\n                        }\r\n\r\n                        setTimeout(function () {\r\n                            $trigger.trigger('contextmenu:hidden');\r\n                        }, 10);\r\n                    });\r\n                }\r\n            },\r\n            create: function (opt, root) {\r\n                if (typeof root === 'undefined') {\r\n                    root = opt;\r\n                }\r\n\r\n                // create contextMenu\r\n                opt.$menu = $('<ul class=\"context-menu-list\"></ul>').addClass(opt.className || '').data({\r\n                    'contextMenu': opt,\r\n                    'contextMenuRoot': root\r\n                });\r\n\r\n                $.each(['callbacks', 'commands', 'inputs'], function (i, k) {\r\n                    opt[k] = {};\r\n                    if (!root[k]) {\r\n                        root[k] = {};\r\n                    }\r\n                });\r\n\r\n                if (!root.accesskeys) {\r\n                    root.accesskeys = {};\r\n                }\r\n\r\n                function createNameNode(item) {\r\n                    var $name = $('<span></span>');\r\n                    if (item._accesskey) {\r\n                        if (item._beforeAccesskey) {\r\n                            $name.append(document.createTextNode(item._beforeAccesskey));\r\n                        }\r\n                        $('<span></span>')\r\n                            .addClass('context-menu-accesskey')\r\n                            .text(item._accesskey)\r\n                            .appendTo($name);\r\n                        if (item._afterAccesskey) {\r\n                            $name.append(document.createTextNode(item._afterAccesskey));\r\n                        }\r\n                    } else {\r\n                        if (item.isHtmlName) {\r\n                            // restrict use with access keys\r\n                            if (typeof item.accesskey !== 'undefined') {\r\n                                throw new Error('accesskeys are not compatible with HTML names and cannot be used together in the same item');\r\n                            }\r\n                            $name.html(item.name);\r\n                        } else {\r\n                            $name.text(item.name);\r\n                        }\r\n                    }\r\n                    return $name;\r\n                }\r\n\r\n                function createContextMenuItems(opt) {\r\n                    $.each(opt.items, function (key, item) {\r\n                        var $t = $('<li class=\"context-menu-item\"></li>').addClass(item.className || ''),\r\n                            $label = null,\r\n                            $input = null;\r\n\r\n                        // iOS needs to see a click-event bound to an element to actually\r\n                        // have the TouchEvents infrastructure trigger the click event\r\n                        $t.on('click', $.noop);\r\n\r\n                        // Make old school string seperator a real item so checks wont be\r\n                        // akward later.\r\n                        // And normalize 'cm_separator' into 'cm_seperator'.\r\n                        if (typeof item === 'string' || item.type === 'cm_separator') {\r\n                            item = {type: 'cm_seperator'};\r\n                        }\r\n\r\n                        item.$node = $t.data({\r\n                            'contextMenu': opt,\r\n                            'contextMenuRoot': root,\r\n                            'contextMenuKey': key\r\n                        });\r\n\r\n                        // register accesskey\r\n                        // NOTE: the accesskey attribute should be applicable to any element, but Safari5 and Chrome13 still can't do that\r\n                        if (typeof item.accesskey !== 'undefined') {\r\n                            var aks = splitAccesskey(item.accesskey);\r\n                            for (var i = 0, ak; ak = aks[i]; i++) {\r\n                                if (!root.accesskeys[ak]) {\r\n                                    root.accesskeys[ak] = item;\r\n                                    var matched = item.name.match(new RegExp('^(.*?)(' + ak + ')(.*)$', 'i'));\r\n                                    if (matched) {\r\n                                        item._beforeAccesskey = matched[1];\r\n                                        item._accesskey = matched[2];\r\n                                        item._afterAccesskey = matched[3];\r\n                                    }\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        if (item.type && types[item.type]) {\r\n                            // run custom type handler\r\n                            types[item.type].call($t, item, opt, root);\r\n                            // register commands\r\n                            $.each([opt, root], function (i, k) {\r\n                                k.commands[key] = item;\r\n                                // Overwrite only if undefined or the item is appended to the root. This so it\r\n                                // doesn't overwrite callbacks of root elements if the name is the same.\r\n                                if ($.isFunction(item.callback) && (typeof k.callbacks[key] === 'undefined' || typeof opt.type === 'undefined')) {\r\n                                    k.callbacks[key] = item.callback;\r\n                                }\r\n                            });\r\n                        } else {\r\n                            // add label for input\r\n                            if (item.type === 'cm_seperator') {\r\n                                $t.addClass('context-menu-separator ' + root.classNames.notSelectable);\r\n                            } else if (item.type === 'html') {\r\n                                $t.addClass('context-menu-html ' + root.classNames.notSelectable);\r\n                            } else if (item.type !== 'sub' && item.type) {\r\n                                $label = $('<label></label>').appendTo($t);\r\n                                createNameNode(item).appendTo($label);\r\n\r\n                                $t.addClass('context-menu-input');\r\n                                opt.hasTypes = true;\r\n                                $.each([opt, root], function (i, k) {\r\n                                    k.commands[key] = item;\r\n                                    k.inputs[key] = item;\r\n                                });\r\n                            } else if (item.items) {\r\n                                item.type = 'sub';\r\n                            }\r\n\r\n                            switch (item.type) {\r\n                                case 'cm_seperator':\r\n                                    break;\r\n\r\n                                case 'text':\r\n                                    $input = $('<input type=\"text\" value=\"1\" name=\"\" />')\r\n                                        .attr('name', 'context-menu-input-' + key)\r\n                                        .val(item.value || '')\r\n                                        .appendTo($label);\r\n                                    break;\r\n\r\n                                case 'textarea':\r\n                                    $input = $('<textarea name=\"\"></textarea>')\r\n                                        .attr('name', 'context-menu-input-' + key)\r\n                                        .val(item.value || '')\r\n                                        .appendTo($label);\r\n\r\n                                    if (item.height) {\r\n                                        $input.height(item.height);\r\n                                    }\r\n                                    break;\r\n\r\n                                case 'checkbox':\r\n                                    $input = $('<input type=\"checkbox\" value=\"1\" name=\"\" />')\r\n                                        .attr('name', 'context-menu-input-' + key)\r\n                                        .val(item.value || '')\r\n                                        .prop('checked', !!item.selected)\r\n                                        .prependTo($label);\r\n                                    break;\r\n\r\n                                case 'radio':\r\n                                    $input = $('<input type=\"radio\" value=\"1\" name=\"\" />')\r\n                                        .attr('name', 'context-menu-input-' + item.radio)\r\n                                        .val(item.value || '')\r\n                                        .prop('checked', !!item.selected)\r\n                                        .prependTo($label);\r\n                                    break;\r\n\r\n                                case 'select':\r\n                                    $input = $('<select name=\"\"></select>')\r\n                                        .attr('name', 'context-menu-input-' + key)\r\n                                        .appendTo($label);\r\n                                    if (item.options) {\r\n                                        $.each(item.options, function (value, text) {\r\n                                            $('<option></option>').val(value).text(text).appendTo($input);\r\n                                        });\r\n                                        $input.val(item.selected);\r\n                                    }\r\n                                    break;\r\n\r\n                                case 'sub':\r\n                                    createNameNode(item).appendTo($t);\r\n                                    item.appendTo = item.$node;\r\n                                    $t.data('contextMenu', item).addClass('context-menu-submenu');\r\n                                    item.callback = null;\r\n\r\n                                    // If item contains items, and this is a promise, we should create it later\r\n                                    // check if subitems is of type promise. If it is a promise we need to create\r\n                                    // it later, after promise has been resolved.\r\n                                    if ('function' === typeof item.items.then) {\r\n                                        // probably a promise, process it, when completed it will create the sub menu's.\r\n                                        op.processPromises(item, root, item.items);\r\n                                    } else {\r\n                                        // normal submenu.\r\n                                        op.create(item, root);\r\n                                    }\r\n                                    break;\r\n\r\n                                case 'html':\r\n                                    $(item.html).appendTo($t);\r\n                                    break;\r\n\r\n                                default:\r\n                                    $.each([opt, root], function (i, k) {\r\n                                        k.commands[key] = item;\r\n                                        // Overwrite only if undefined or the item is appended to the root. This so it\r\n                                        // doesn't overwrite callbacks of root elements if the name is the same.\r\n                                        if ($.isFunction(item.callback) && (typeof k.callbacks[key] === 'undefined' || typeof opt.type === 'undefined')) {\r\n                                            k.callbacks[key] = item.callback;\r\n                                        }\r\n                                    });\r\n                                    createNameNode(item).appendTo($t);\r\n                                    break;\r\n                            }\r\n\r\n                            // disable key listener in <input>\r\n                            if (item.type && item.type !== 'sub' && item.type !== 'html' && item.type !== 'cm_seperator') {\r\n                                $input\r\n                                    .on('focus', handle.focusInput)\r\n                                    .on('blur', handle.blurInput);\r\n\r\n                                if (item.events) {\r\n                                    $input.on(item.events, opt);\r\n                                }\r\n                            }\r\n\r\n                            // add icons\r\n                            if (item.icon) {\r\n                                if ($.isFunction(item.icon)) {\r\n                                    item._icon = item.icon.call(this, this, $t, key, item);\r\n                                } else {\r\n                                    if (typeof(item.icon) === 'string' && (\r\n                                        item.icon.substring(0, 4) === 'fab '\r\n                                        || item.icon.substring(0, 4) === 'fas '\r\n                                        || item.icon.substring(0, 4) === 'far '\r\n                                        || item.icon.substring(0, 4) === 'fal ')\r\n                                    ) {\r\n                                        // to enable font awesome\r\n                                        $t.addClass(root.classNames.icon + ' ' + root.classNames.icon + '--fa5');\r\n                                        item._icon = $('<i class=\"' + item.icon + '\"></i>');\r\n                                    } else if (typeof(item.icon) === 'string' && item.icon.substring(0, 3) === 'fa-') {\r\n                                        item._icon = root.classNames.icon + ' ' + root.classNames.icon + '--fa fa ' + item.icon;\r\n                                    } else {\r\n                                        item._icon = root.classNames.icon + ' ' + root.classNames.icon + '-' + item.icon;\r\n                                    }\r\n                                }\r\n\r\n                                if(typeof(item._icon) === \"string\"){\r\n                                    $t.addClass(item._icon);\r\n                                } else {\r\n                                    $t.prepend(item._icon);\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        // cache contained elements\r\n                        item.$input = $input;\r\n                        item.$label = $label;\r\n\r\n                        // attach item to menu\r\n                        $t.appendTo(opt.$menu);\r\n\r\n                        // Disable text selection\r\n                        if (!opt.hasTypes && $.support.eventSelectstart) {\r\n                            // browsers support user-select: none,\r\n                            // IE has a special event for text-selection\r\n                            // browsers supporting neither will not be preventing text-selection\r\n                            $t.on('selectstart.disableTextSelect', handle.abortevent);\r\n                        }\r\n                    });\r\n                    // attach contextMenu to <body> (to bypass any possible overflow:hidden issues on parents of the trigger element)\r\n                    if (!opt.$node) {\r\n                        opt.$menu.css('display', 'none').addClass('context-menu-root');\r\n                    }\r\n                    opt.$menu.appendTo(opt.appendTo || document.body);\r\n                }\r\n\r\n                function completedPromise(opt, items) {\r\n                    // Completed promise (dev called promise.resolve). We now have a list of items which can\r\n                    // be used to create the rest of the context menu.\r\n                    if (typeof items === 'undefined') {\r\n                        // Null result, dev should have checked\r\n                        errorPromise(undefined);//own error object\r\n                    }\r\n                    finishPromiseProcess(opt, items);\r\n                }\r\n\r\n                function errorPromise(opt, errorItem) {\r\n                    // User called promise.reject() with an error item, if not, provide own error item.\r\n                    if (typeof errorItem === 'undefined') {\r\n                        errorItem = {\r\n                            \"error\": {\r\n                                name: \"No items and no error item\",\r\n                                icon: \"context-menu-icon context-menu-icon-quit\"\r\n                            }\r\n                        };\r\n                        if (window.console) {\r\n                            (console.error || console.log).call(console, 'When you reject a promise, provide an \"items\" object, equal to normal sub-menu items');\r\n                        }\r\n                    } else if (typeof errorItem === 'string') {\r\n                        errorItem = { \"error\": { name: errorItem } };\r\n                    }\r\n                    finishPromiseProcess(opt, errorItem);\r\n                }\r\n\r\n                function finishPromiseProcess(opt, items) {\r\n                    opt.items = items;\r\n                    createContextMenuItems(opt);\r\n                }\r\n\r\n                // create contextMenu items\r\n                // If items is a promise, we should create it later, after promise has been resolved.\r\n                if ('function' === typeof opt.items.then) {\r\n                    return opt.items.then(completedPromise.bind(this, opt), errorPromise.bind(this, opt));\r\n                } else {\r\n                    // normal menu.\r\n                    createContextMenuItems(opt);\r\n\r\n                    return $.Deferred().resolve().promise();\r\n                }\r\n            },\r\n            resize: function ($menu, nested) {\r\n                var domMenu;\r\n                // determine widths of submenus, as CSS won't grow them automatically\r\n                // position:absolute within position:absolute; min-width:100; max-width:200; results in width: 100;\r\n                // kinda sucks hard...\r\n\r\n                // determine width of absolutely positioned element\r\n                $menu.css({position: 'absolute', display: 'block'});\r\n                // don't apply yet, because that would break nested elements' widths\r\n                $menu.data('width',\r\n                    (domMenu = $menu.get(0)).getBoundingClientRect ?\r\n                        Math.ceil(domMenu.getBoundingClientRect().width) :\r\n                        $menu.outerWidth() + 1); // outerWidth() returns rounded pixels\r\n                // reset styles so they allow nested elements to grow/shrink naturally\r\n                $menu.css({\r\n                    position: 'static',\r\n                    minWidth: '0px',\r\n                    maxWidth: '100000px'\r\n                });\r\n                // identify width of nested menus\r\n                $menu.find('> li > ul').each(function () {\r\n                    op.resize($(this), true);\r\n                });\r\n                // reset and apply changes in the end because nested\r\n                // elements' widths wouldn't be calculatable otherwise\r\n                if (!nested) {\r\n                    $menu.find('ul').addBack().css({\r\n                        position: '',\r\n                        display: '',\r\n                        minWidth: '',\r\n                        maxWidth: ''\r\n                    }).outerWidth(function () {\r\n                        return $(this).data('width');\r\n                    });\r\n                }\r\n            },\r\n            update: function (opt, root) {\r\n                var $trigger = this;\r\n                if (typeof root === 'undefined') {\r\n                    root = opt;\r\n                    op.resize(opt.$menu);\r\n                }\r\n\r\n                var hasVisibleItems = false;\r\n\r\n                // re-check disabled for each item\r\n                opt.$menu.children().each(function () {\r\n                    var $item = $(this),\r\n                        key = $item.data('contextMenuKey'),\r\n                        item = opt.items[key],\r\n                        disabled = ($.isFunction(item.disabled) && item.disabled.call($trigger, key, root)) || item.disabled === true,\r\n                        visible;\r\n                    if ($.isFunction(item.visible)) {\r\n                        visible = item.visible.call($trigger, key, root);\r\n                    } else if (typeof item.visible !== 'undefined') {\r\n                        visible = item.visible === true;\r\n                    } else {\r\n                        visible = true;\r\n                    }\r\n\r\n                    if (visible) {\r\n                        hasVisibleItems = true;\r\n                    }\r\n\r\n                    $item[visible ? 'show' : 'hide']();\r\n\r\n                    // dis- / enable item\r\n                    $item[disabled ? 'addClass' : 'removeClass'](root.classNames.disabled);\r\n\r\n                    if ($.isFunction(item.icon)) {\r\n                        $item.removeClass(item._icon);\r\n                        var iconResult = item.icon.call(this, $trigger, $item, key, item);\r\n                        if(typeof(iconResult) === \"string\"){\r\n                            $item.addClass(iconResult);\r\n                        } else {\r\n                            $item.prepend(iconResult);\r\n                        }\r\n                    }\r\n\r\n                    if (item.type) {\r\n                        // dis- / enable input elements\r\n                        $item.find('input, select, textarea').prop('disabled', disabled);\r\n\r\n                        // update input states\r\n                        switch (item.type) {\r\n                            case 'text':\r\n                            case 'textarea':\r\n                                item.$input.val(item.value || '');\r\n                                break;\r\n\r\n                            case 'checkbox':\r\n                            case 'radio':\r\n                                item.$input.val(item.value || '').prop('checked', !!item.selected);\r\n                                break;\r\n\r\n                            case 'select':\r\n                                item.$input.val((item.selected === 0 ? \"0\" : item.selected) || '');\r\n                                break;\r\n                        }\r\n                    }\r\n\r\n                    if (item.$menu) {\r\n                        // update sub-menu\r\n                        var subMenuHasVisibleItems = op.update.call($trigger, item, root);\r\n                        if (subMenuHasVisibleItems) {\r\n                            hasVisibleItems = true;\r\n                        }\r\n                    }\r\n                });\r\n                return hasVisibleItems;\r\n            },\r\n            layer: function (opt, zIndex) {\r\n                // add transparent layer for click area\r\n                // filter and background for Internet Explorer, Issue #23\r\n                var $layer = opt.$layer = $('<div id=\"context-menu-layer\"></div>')\r\n                    .css({\r\n                        height: $win.height(),\r\n                        width: $win.width(),\r\n                        display: 'block',\r\n                        position: 'fixed',\r\n                        'z-index': zIndex,\r\n                        top: 0,\r\n                        left: 0,\r\n                        opacity: 0,\r\n                        filter: 'alpha(opacity=0)',\r\n                        'background-color': '#000'\r\n                    })\r\n                    .data('contextMenuRoot', opt)\r\n                    .insertBefore(this)\r\n                    .on('contextmenu', handle.abortevent)\r\n                    .on('mousedown', handle.layerClick);\r\n\r\n                // IE6 doesn't know position:fixed;\r\n                if (typeof document.body.style.maxWidth === 'undefined') { // IE6 doesn't support maxWidth\r\n                    $layer.css({\r\n                        'position': 'absolute',\r\n                        'height': $(document).height()\r\n                    });\r\n                }\r\n\r\n                return $layer;\r\n            },\r\n            processPromises: function (opt, root, promise) {\r\n                // Start\r\n                opt.$node.addClass(root.classNames.iconLoadingClass);\r\n\r\n                function completedPromise(opt, root, items) {\r\n                    // Completed promise (dev called promise.resolve). We now have a list of items which can\r\n                    // be used to create the rest of the context menu.\r\n                    if (typeof items === 'undefined') {\r\n                        // Null result, dev should have checked\r\n                        errorPromise(undefined);//own error object\r\n                    }\r\n                    finishPromiseProcess(opt, root, items);\r\n                }\r\n\r\n                function errorPromise(opt, root, errorItem) {\r\n                    // User called promise.reject() with an error item, if not, provide own error item.\r\n                    if (typeof errorItem === 'undefined') {\r\n                        errorItem = {\r\n                            \"error\": {\r\n                                name: \"No items and no error item\",\r\n                                icon: \"context-menu-icon context-menu-icon-quit\"\r\n                            }\r\n                        };\r\n                        if (window.console) {\r\n                            (console.error || console.log).call(console, 'When you reject a promise, provide an \"items\" object, equal to normal sub-menu items');\r\n                        }\r\n                    } else if (typeof errorItem === 'string') {\r\n                        errorItem = {\"error\": {name: errorItem}};\r\n                    }\r\n                    finishPromiseProcess(opt, root, errorItem);\r\n                }\r\n\r\n                function finishPromiseProcess(opt, root, items) {\r\n                    if (typeof root.$menu === 'undefined' || !root.$menu.is(':visible')) {\r\n                        return;\r\n                    }\r\n                    opt.$node.removeClass(root.classNames.iconLoadingClass);\r\n                    opt.items = items;\r\n                    op.create(opt, root, true) // Create submenu\r\n                        .then(function () {\r\n                            op.update(opt, root); // Correctly update position if user is already hovered over menu item\r\n                            root.positionSubmenu.call(opt.$node, opt.$menu); // positionSubmenu, will only do anything if user already hovered over menu item that just got new subitems.\r\n                        });\r\n                }\r\n\r\n                // Wait for promise completion. .then(success, error, notify) (we don't track notify). Bind the opt\r\n                // and root to avoid scope problems\r\n                promise.then(completedPromise.bind(this, opt, root), errorPromise.bind(this, opt, root));\r\n            },\r\n            // operation that will run after contextMenu showed on screen\r\n            activated: function(opt){\r\n                var menus = opt.$menu.find('.context-menu-list').addBack();\r\n                menus.each(function (index, menuElm) {\r\n                    var $menu = $(menuElm);\r\n                    var $menuOffset = $menu.offset();\r\n                    var winHeight = $(window).height();\r\n                    var winScrollTop = $(window).scrollTop();\r\n                    var menuHeight = $menu.height();\r\n                    if(menuHeight > winHeight){\r\n                        $menu.css({\r\n                            'height' : winHeight + 'px',\r\n                            'overflow-x': 'hidden',\r\n                            'overflow-y': 'auto',\r\n                            'top': winScrollTop + 'px'\r\n                        });\r\n                    } else if(($menuOffset.top < winScrollTop) || ($menuOffset.top + menuHeight > winScrollTop + winHeight)){\r\n                        $menu.css({\r\n                        'top': winScrollTop + 'px'\r\n                        });\r\n                    } \r\n                });\r\n                \r\n            }\r\n        };\r\n\r\n    // split accesskey according to http://www.whatwg.org/specs/web-apps/current-work/multipage/editing.html#assigned-access-key\r\n    function splitAccesskey(val) {\r\n        var t = val.split(/\\s+/);\r\n        var keys = [];\r\n\r\n        for (var i = 0, k; k = t[i]; i++) {\r\n            k = k.charAt(0).toUpperCase(); // first character only\r\n            // theoretically non-accessible characters should be ignored, but different systems, different keyboard layouts, ... screw it.\r\n            // a map to look up already used access keys would be nice\r\n            keys.push(k);\r\n        }\r\n\r\n        return keys;\r\n    }\r\n\r\n// handle contextMenu triggers\r\n    $.fn.contextMenu = function (operation) {\r\n        var $t = this, $o = operation;\r\n        if (this.length > 0) {  // this is not a build on demand menu\r\n            if (typeof operation === 'undefined') {\r\n                this.first().trigger('contextmenu');\r\n            } else if (typeof operation.x !== 'undefined' && typeof operation.y !== 'undefined') {\r\n                this.first().trigger($.Event('contextmenu', {\r\n                    pageX: operation.x,\r\n                    pageY: operation.y,\r\n                    mouseButton: operation.button\r\n                }));\r\n            } else if (operation === 'hide') {\r\n                var $menu = this.first().data('contextMenu') ? this.first().data('contextMenu').$menu : null;\r\n                if ($menu) {\r\n                    $menu.trigger('contextmenu:hide');\r\n                }\r\n            } else if (operation === 'destroy') {\r\n                $.contextMenu('destroy', {context: this});\r\n            } else if ($.isPlainObject(operation)) {\r\n                operation.context = this;\r\n                $.contextMenu('create', operation);\r\n            } else if (operation) {\r\n                this.removeClass('context-menu-disabled');\r\n            } else if (!operation) {\r\n                this.addClass('context-menu-disabled');\r\n            }\r\n        } else {\r\n            $.each(menus, function () {\r\n                if (this.selector === $t.selector) {\r\n                    $o.data = this;\r\n\r\n                    $.extend($o.data, {trigger: 'demand'});\r\n                }\r\n            });\r\n\r\n            handle.contextmenu.call($o.target, $o);\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    // manage contextMenu instances\r\n    $.contextMenu = function (operation, options) {\r\n        if (typeof operation !== 'string') {\r\n            options = operation;\r\n            operation = 'create';\r\n        }\r\n\r\n        if (typeof options === 'string') {\r\n            options = {selector: options};\r\n        } else if (typeof options === 'undefined') {\r\n            options = {};\r\n        }\r\n\r\n        // merge with default options\r\n        var o = $.extend(true, {}, defaults, options || {});\r\n        var $document = $(document);\r\n        var $context = $document;\r\n        var _hasContext = false;\r\n\r\n        if (!o.context || !o.context.length) {\r\n            o.context = document;\r\n        } else {\r\n            // you never know what they throw at you...\r\n            $context = $(o.context).first();\r\n            o.context = $context.get(0);\r\n            _hasContext = !$(o.context).is(document);\r\n        }\r\n\r\n        switch (operation) {\r\n\r\n            case 'update':\r\n                // Updates visibility and such\r\n                if(_hasContext){\r\n                    op.update($context);\r\n                } else {\r\n                    for(var menu in menus){\r\n                        if(menus.hasOwnProperty(menu)){\r\n                            op.update(menus[menu]);\r\n                        }\r\n                    }\r\n                }\r\n                break;\r\n\r\n            case 'create':\r\n                // no selector no joy\r\n                if (!o.selector) {\r\n                    throw new Error('No selector specified');\r\n                }\r\n                // make sure internal classes are not bound to\r\n                if (o.selector.match(/.context-menu-(list|item|input)($|\\s)/)) {\r\n                    throw new Error('Cannot bind to selector \"' + o.selector + '\" as it contains a reserved className');\r\n                }\r\n                if (!o.build && (!o.items || $.isEmptyObject(o.items))) {\r\n                    throw new Error('No Items specified');\r\n                }\r\n                counter++;\r\n                o.ns = '.contextMenu' + counter;\r\n                if (!_hasContext) {\r\n                    namespaces[o.selector] = o.ns;\r\n                }\r\n                menus[o.ns] = o;\r\n\r\n                // default to right click\r\n                if (!o.trigger) {\r\n                    o.trigger = 'right';\r\n                }\r\n\r\n                if (!initialized) {\r\n                    var itemClick = o.itemClickEvent === 'click' ? 'click.contextMenu' : 'mouseup.contextMenu';\r\n                    var contextMenuItemObj = {\r\n                        // 'mouseup.contextMenu': handle.itemClick,\r\n                        // 'click.contextMenu': handle.itemClick,\r\n                        'contextmenu:focus.contextMenu': handle.focusItem,\r\n                        'contextmenu:blur.contextMenu': handle.blurItem,\r\n                        'contextmenu.contextMenu': handle.abortevent,\r\n                        'mouseenter.contextMenu': handle.itemMouseenter,\r\n                        'mouseleave.contextMenu': handle.itemMouseleave\r\n                    };\r\n                    contextMenuItemObj[itemClick] = handle.itemClick;\r\n                    // make sure item click is registered first\r\n                    $document\r\n                        .on({\r\n                            'contextmenu:hide.contextMenu': handle.hideMenu,\r\n                            'prevcommand.contextMenu': handle.prevItem,\r\n                            'nextcommand.contextMenu': handle.nextItem,\r\n                            'contextmenu.contextMenu': handle.abortevent,\r\n                            'mouseenter.contextMenu': handle.menuMouseenter,\r\n                            'mouseleave.contextMenu': handle.menuMouseleave\r\n                        }, '.context-menu-list')\r\n                        .on('mouseup.contextMenu', '.context-menu-input', handle.inputClick)\r\n                        .on(contextMenuItemObj, '.context-menu-item');\r\n\r\n                    initialized = true;\r\n                }\r\n\r\n                // engage native contextmenu event\r\n                $context\r\n                    .on('contextmenu' + o.ns, o.selector, o, handle.contextmenu);\r\n\r\n                if (_hasContext) {\r\n                    // add remove hook, just in case\r\n                    $context.on('remove' + o.ns, function () {\r\n                        $(this).contextMenu('destroy');\r\n                    });\r\n                }\r\n\r\n                switch (o.trigger) {\r\n                    case 'hover':\r\n                        $context\r\n                            .on('mouseenter' + o.ns, o.selector, o, handle.mouseenter)\r\n                            .on('mouseleave' + o.ns, o.selector, o, handle.mouseleave);\r\n                        break;\r\n\r\n                    case 'left':\r\n                        $context.on('click' + o.ns, o.selector, o, handle.click);\r\n                        break;\r\n\t\t\t\t    case 'touchstart':\r\n                        $context.on('touchstart' + o.ns, o.selector, o, handle.click);\r\n                        break;\r\n                    /*\r\n                     default:\r\n                     // http://www.quirksmode.org/dom/events/contextmenu.html\r\n                     $document\r\n                     .on('mousedown' + o.ns, o.selector, o, handle.mousedown)\r\n                     .on('mouseup' + o.ns, o.selector, o, handle.mouseup);\r\n                     break;\r\n                     */\r\n                }\r\n\r\n                // create menu\r\n                if (!o.build) {\r\n                    op.create(o);\r\n                }\r\n                break;\r\n\r\n            case 'destroy':\r\n                var $visibleMenu;\r\n                if (_hasContext) {\r\n                    // get proper options\r\n                    var context = o.context;\r\n                    $.each(menus, function (ns, o) {\r\n\r\n                        if (!o) {\r\n                            return true;\r\n                        }\r\n\r\n                        // Is this menu equest to the context called from\r\n                        if (!$(context).is(o.selector)) {\r\n                            return true;\r\n                        }\r\n\r\n                        $visibleMenu = $('.context-menu-list').filter(':visible');\r\n                        if ($visibleMenu.length && $visibleMenu.data().contextMenuRoot.$trigger.is($(o.context).find(o.selector))) {\r\n                            $visibleMenu.trigger('contextmenu:hide', {force: true});\r\n                        }\r\n\r\n                        try {\r\n                            if (menus[o.ns].$menu) {\r\n                                menus[o.ns].$menu.remove();\r\n                            }\r\n\r\n                            delete menus[o.ns];\r\n                        } catch (e) {\r\n                            menus[o.ns] = null;\r\n                        }\r\n\r\n                        $(o.context).off(o.ns);\r\n\r\n                        return true;\r\n                    });\r\n                } else if (!o.selector) {\r\n                    $document.off('.contextMenu .contextMenuAutoHide');\r\n                    $.each(menus, function (ns, o) {\r\n                        $(o.context).off(o.ns);\r\n                    });\r\n\r\n                    namespaces = {};\r\n                    menus = {};\r\n                    counter = 0;\r\n                    initialized = false;\r\n\r\n                    $('#context-menu-layer, .context-menu-list').remove();\r\n                } else if (namespaces[o.selector]) {\r\n                    $visibleMenu = $('.context-menu-list').filter(':visible');\r\n                    if ($visibleMenu.length && $visibleMenu.data().contextMenuRoot.$trigger.is(o.selector)) {\r\n                        $visibleMenu.trigger('contextmenu:hide', {force: true});\r\n                    }\r\n\r\n                    try {\r\n                        if (menus[namespaces[o.selector]].$menu) {\r\n                            menus[namespaces[o.selector]].$menu.remove();\r\n                        }\r\n\r\n                        delete menus[namespaces[o.selector]];\r\n                    } catch (e) {\r\n                        menus[namespaces[o.selector]] = null;\r\n                    }\r\n\r\n                    $document.off(namespaces[o.selector]);\r\n                }\r\n                break;\r\n\r\n            case 'html5':\r\n                // if <command> and <menuitem> are not handled by the browser,\r\n                // or options was a bool true,\r\n                // initialize $.contextMenu for them\r\n                if ((!$.support.htmlCommand && !$.support.htmlMenuitem) || (typeof options === 'boolean' && options)) {\r\n                    $('menu[type=\"context\"]').each(function () {\r\n                        if (this.id) {\r\n                            $.contextMenu({\r\n                                selector: '[contextmenu=' + this.id + ']',\r\n                                items: $.contextMenu.fromMenu(this)\r\n                            });\r\n                        }\r\n                    }).css('display', 'none');\r\n                }\r\n                break;\r\n\r\n            default:\r\n                throw new Error('Unknown operation \"' + operation + '\"');\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n// import values into <input> commands\r\n    $.contextMenu.setInputValues = function (opt, data) {\r\n        if (typeof data === 'undefined') {\r\n            data = {};\r\n        }\r\n\r\n        $.each(opt.inputs, function (key, item) {\r\n            switch (item.type) {\r\n                case 'text':\r\n                case 'textarea':\r\n                    item.value = data[key] || '';\r\n                    break;\r\n\r\n                case 'checkbox':\r\n                    item.selected = data[key] ? true : false;\r\n                    break;\r\n\r\n                case 'radio':\r\n                    item.selected = (data[item.radio] || '') === item.value;\r\n                    break;\r\n\r\n                case 'select':\r\n                    item.selected = data[key] || '';\r\n                    break;\r\n            }\r\n        });\r\n    };\r\n\r\n// export values from <input> commands\r\n    $.contextMenu.getInputValues = function (opt, data) {\r\n        if (typeof data === 'undefined') {\r\n            data = {};\r\n        }\r\n\r\n        $.each(opt.inputs, function (key, item) {\r\n            switch (item.type) {\r\n                case 'text':\r\n                case 'textarea':\r\n                case 'select':\r\n                    data[key] = item.$input.val();\r\n                    break;\r\n\r\n                case 'checkbox':\r\n                    data[key] = item.$input.prop('checked');\r\n                    break;\r\n\r\n                case 'radio':\r\n                    if (item.$input.prop('checked')) {\r\n                        data[item.radio] = item.value;\r\n                    }\r\n                    break;\r\n            }\r\n        });\r\n\r\n        return data;\r\n    };\r\n\r\n// find <label for=\"xyz\">\r\n    function inputLabel(node) {\r\n        return (node.id && $('label[for=\"' + node.id + '\"]').val()) || node.name;\r\n    }\r\n\r\n// convert <menu> to items object\r\n    function menuChildren(items, $children, counter) {\r\n        if (!counter) {\r\n            counter = 0;\r\n        }\r\n\r\n        $children.each(function () {\r\n            var $node = $(this),\r\n                node = this,\r\n                nodeName = this.nodeName.toLowerCase(),\r\n                label,\r\n                item;\r\n\r\n            // extract <label><input>\r\n            if (nodeName === 'label' && $node.find('input, textarea, select').length) {\r\n                label = $node.text();\r\n                $node = $node.children().first();\r\n                node = $node.get(0);\r\n                nodeName = node.nodeName.toLowerCase();\r\n            }\r\n\r\n            /*\r\n             * <menu> accepts flow-content as children. that means <embed>, <canvas> and such are valid menu items.\r\n             * Not being the sadistic kind, $.contextMenu only accepts:\r\n             * <command>, <menuitem>, <hr>, <span>, <p> <input [text, radio, checkbox]>, <textarea>, <select> and of course <menu>.\r\n             * Everything else will be imported as an html node, which is not interfaced with contextMenu.\r\n             */\r\n\r\n            // http://www.whatwg.org/specs/web-apps/current-work/multipage/commands.html#concept-command\r\n            switch (nodeName) {\r\n                // http://www.whatwg.org/specs/web-apps/current-work/multipage/interactive-elements.html#the-menu-element\r\n                case 'menu':\r\n                    item = {name: $node.attr('label'), items: {}};\r\n                    counter = menuChildren(item.items, $node.children(), counter);\r\n                    break;\r\n\r\n                // http://www.whatwg.org/specs/web-apps/current-work/multipage/commands.html#using-the-a-element-to-define-a-command\r\n                case 'a':\r\n                // http://www.whatwg.org/specs/web-apps/current-work/multipage/commands.html#using-the-button-element-to-define-a-command\r\n                case 'button':\r\n                    item = {\r\n                        name: $node.text(),\r\n                        disabled: !!$node.attr('disabled'),\r\n                        callback: (function () {\r\n                            return function () {\r\n                                $node.get(0).click();\r\n                            };\r\n                        })()\r\n                    };\r\n                    break;\r\n\r\n                // http://www.whatwg.org/specs/web-apps/current-work/multipage/commands.html#using-the-command-element-to-define-a-command\r\n                case 'menuitem':\r\n                case 'command':\r\n                    switch ($node.attr('type')) {\r\n                        case undefined:\r\n                        case 'command':\r\n                        case 'menuitem':\r\n                            item = {\r\n                                name: $node.attr('label'),\r\n                                disabled: !!$node.attr('disabled'),\r\n                                icon: $node.attr('icon'),\r\n                                callback: (function () {\r\n                                    return function () {\r\n                                        $node.get(0).click();\r\n                                    };\r\n                                })()\r\n                            };\r\n                            break;\r\n\r\n                        case 'checkbox':\r\n                            item = {\r\n                                type: 'checkbox',\r\n                                disabled: !!$node.attr('disabled'),\r\n                                name: $node.attr('label'),\r\n                                selected: !!$node.attr('checked')\r\n                            };\r\n                            break;\r\n                        case 'radio':\r\n                            item = {\r\n                                type: 'radio',\r\n                                disabled: !!$node.attr('disabled'),\r\n                                name: $node.attr('label'),\r\n                                radio: $node.attr('radiogroup'),\r\n                                value: $node.attr('id'),\r\n                                selected: !!$node.attr('checked')\r\n                            };\r\n                            break;\r\n\r\n                        default:\r\n                            item = undefined;\r\n                    }\r\n                    break;\r\n\r\n                case 'hr':\r\n                    item = '-------';\r\n                    break;\r\n\r\n                case 'input':\r\n                    switch ($node.attr('type')) {\r\n                        case 'text':\r\n                            item = {\r\n                                type: 'text',\r\n                                name: label || inputLabel(node),\r\n                                disabled: !!$node.attr('disabled'),\r\n                                value: $node.val()\r\n                            };\r\n                            break;\r\n\r\n                        case 'checkbox':\r\n                            item = {\r\n                                type: 'checkbox',\r\n                                name: label || inputLabel(node),\r\n                                disabled: !!$node.attr('disabled'),\r\n                                selected: !!$node.attr('checked')\r\n                            };\r\n                            break;\r\n\r\n                        case 'radio':\r\n                            item = {\r\n                                type: 'radio',\r\n                                name: label || inputLabel(node),\r\n                                disabled: !!$node.attr('disabled'),\r\n                                radio: !!$node.attr('name'),\r\n                                value: $node.val(),\r\n                                selected: !!$node.attr('checked')\r\n                            };\r\n                            break;\r\n\r\n                        default:\r\n                            item = undefined;\r\n                            break;\r\n                    }\r\n                    break;\r\n\r\n                case 'select':\r\n                    item = {\r\n                        type: 'select',\r\n                        name: label || inputLabel(node),\r\n                        disabled: !!$node.attr('disabled'),\r\n                        selected: $node.val(),\r\n                        options: {}\r\n                    };\r\n                    $node.children().each(function () {\r\n                        item.options[this.value] = $(this).text();\r\n                    });\r\n                    break;\r\n\r\n                case 'textarea':\r\n                    item = {\r\n                        type: 'textarea',\r\n                        name: label || inputLabel(node),\r\n                        disabled: !!$node.attr('disabled'),\r\n                        value: $node.val()\r\n                    };\r\n                    break;\r\n\r\n                case 'label':\r\n                    break;\r\n\r\n                default:\r\n                    item = {type: 'html', html: $node.clone(true)};\r\n                    break;\r\n            }\r\n\r\n            if (item) {\r\n                counter++;\r\n                items['key' + counter] = item;\r\n            }\r\n        });\r\n\r\n        return counter;\r\n    }\r\n\r\n// convert html5 menu\r\n    $.contextMenu.fromMenu = function (element) {\r\n        var $this = $(element),\r\n            items = {};\r\n\r\n        menuChildren(items, $this.children());\r\n\r\n        return items;\r\n    };\r\n\r\n// make defaults accessible\r\n    $.contextMenu.defaults = defaults;\r\n    $.contextMenu.types = types;\r\n// export internal functions - undocumented, for hacking only!\r\n    $.contextMenu.handle = handle;\r\n    $.contextMenu.op = op;\r\n    $.contextMenu.menus = menus;\r\n});\r\n"]}